{% extends 'base.html' %}
{% load static %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    
    <div style="background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; margin-bottom: 30px;">
        <h2 style="color: #0f172a; margin-bottom: 10px;">Find Patient Records</h2>
        <p style="color: #64748b; margin-bottom: 30px;">Enter registered Phone Number or Name to view medical history.</p>

        <form method="GET" action="{% url 'search_patient' %}" style="display: flex; gap: 10px; justify-content: center;">
            <input type="text" name="q" placeholder="e.g. 9876543210" value="{{ query|default:'' }}" required
                style="padding: 15px; width: 60%; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px;">
            <button type="submit" 
                style="background: #3b82f6; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: 600; cursor: pointer;">
                <i class="fas fa-search"></i> Search
            </button>
        </form>

        {% if error_message %}
        <div style="margin-top: 20px; background: #fee2e2; color: #991b1b; padding: 15px; border-radius: 8px; border: 1px solid #fecaca;">
            <i class="fas fa-exclamation-circle"></i> {{ error_message }}
        </div>
        {% endif %}
    </div>

    {% if patients %}
    <div style="background: white; padding: 30px; border-radius: 16px; border: 1px solid #e2e8f0;">
        <h3 style="margin-bottom: 20px;">Search Results</h3>
        {% for p in patients %}
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f1f5f9;">
            <div>
                <div style="font-weight: 700; font-size: 18px;">{{ p.name }}</div>
                <div style="color: #64748b; font-size: 14px;">{{ p.phone }} | {{ p.gender }}</div>
            </div>
            <a href="?view_id={{ p.id }}&q={{ query }}" style="background: #eff6ff; color: #3b82f6; padding: 8px 15px; text-decoration: none; border-radius: 6px; font-weight: 600;">
                View Records
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if selected_patient %}
    <div style="margin-top: 30px; background: white; padding: 30px; border-radius: 16px; border: 1px solid #e2e8f0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3>Medical History: <span style="color: #3b82f6;">{{ selected_patient.name }}</span></h3>
            <a href="{% url 'new_patient' %}" style="color: #64748b; text-decoration: none; font-size: 14px;">
                <i class="fas fa-plus"></i> Add New Checkup
            </a>
        </div>
        
        {% if history %}
            <div style="display: grid; gap: 15px;">
                {% for report in history %}
                <a href="{% url 'generate_dynamic_diet_plan' selected_patient.id report.id %}" 
                   style="display: block; background: #f8fafc; padding: 20px; border-radius: 10px; text-decoration: none; color: inherit; border-left: 5px solid #3b82f6; transition: 0.3s;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-weight: 700;">Report #{{ report.id }}</span>
                        <span style="color: #64748b; font-size: 13px;">{{ report.date }}</span>
                    </div>
                    <div style="margin-top: 5px; font-size: 14px;">
                        Weight: {{ report.weight }}kg • BMI: {{ report.bmi }} • Goal: {{ report.category }}
                    </div>
                </a>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; color: #94a3b8; padding: 20px;">
                No checkup reports found for this patient. <a href="{% url 'new_patient' %}">Create one now?</a>
            </div>
        {% endif %}
    </div>
    {% endif %}

</div>
{% endblock %}