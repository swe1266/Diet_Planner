{% extends 'base.html' %}
{% block title %}Health Calculator{% endblock %}

{% block content %}
{% if not user.is_authenticated %}
<div class="alert alert-warning">
    Please <a href="{% url 'login' %}">login</a> or <a href="{% url 'register' %}">register</a> to use the calculator.
</div>
{% else %}
<div class="row">
    <div class="col-md-6">
        <div class="card p-4">
            <h4>Enter Your Details</h4>
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label>Age:</label>
                    <input type="number" name="age" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Weight (kg):</label>
                    <input type="number" step="0.1" name="weight" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Height (cm):</label>
                    <input type="number" name="height" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Gender:</label>
                    <select name="gender" class="form-control">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label>Activity Level:</label>
                    <select name="activity" class="form-control">
                        <option value="sedentary">Sedentary</option>
                        <option value="light">Light</option>
                        <option value="moderate">Moderate</option>
                        <option value="active">Active</option>
                        <option value="very_active">Very Active</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label>Profile Type:</label>
                    <select name="profile_type" class="form-control">
                        <option value="general">General</option>
                        <option value="pregnant">Pregnant</option>
                        <option value="athlete">Athlete/Gym</option>
                        <option value="diabetes">Diabetes</option>
                        <option value="post_surgery">Post Surgery</option>
                    </select>
                </div>
                <div class="mb-3" id="trimester_div" style="display:none;">
                    <label>Trimester:</label>
                    <select name="trimester" class="form-control">
                        <option value="">Select</option>
                        <option value="first">1st</option>
                        <option value="second">2nd</option>
                        <option value="third">3rd</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success w-100">Calculate Plan</button>
            </form>
        </div>
    </div>
</div>
{% endif %}  <!-- THIS WAS MISSING! -->

<script>
document.querySelector('[name="profile_type"]').addEventListener('change', function() {
    document.getElementById('trimester_div').style.display = 
        this.value === 'pregnant' ? 'block' : 'none';
});
</script>
{% endblock %}
